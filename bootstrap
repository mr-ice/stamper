#!/bin/bash
# Bootstrap script for TS (Timestamp Tool)
# This script sets up the build environment and generates necessary files

set -e

echo "Bootstrapping TS build environment..."

# Check for required tools
check_tool() {
    if ! command -v "$1" >/dev/null 2>&1; then
        echo "ERROR: $1 is required but not found. Please install it first."
        exit 1
    fi
}

echo "Checking for required tools..."
check_tool autoconf
check_tool automake
check_tool aclocal
check_tool make
check_tool gcc

# Create build-aux directory if it doesn't exist
echo "Setting up build directories..."
mkdir -p build-aux

# Generate aclocal.m4 (required for AM_INIT_AUTOMAKE and AM_CONDITIONAL)
echo "Generating aclocal.m4..."
aclocal

# Generate configure script
echo "Generating configure script..."
autoconf

# Generate config.h.in
echo "Generating config.h.in..."
autoheader

# Generate Makefile.in
echo "Generating Makefile.in..."
automake --add-missing --copy

echo "Bootstrap complete!"
echo ""
echo "Next steps:"
echo "  ./configure"
echo "  make"
echo "  make test"
echo ""
echo "For more information, see BUILD.md" 